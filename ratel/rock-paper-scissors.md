# RockPaperScissors

RockPaperScissors is a two-player game, in which each player simultaneously forms one of three choices(rock, paper, and scissors).
For each player, the game has three possible outcomes: a draw, a win, or a loss.
A player who decides to play rock will beat another player who has chosen scissors, but will lose to one who has played paper; a play of paper will lose to a play of scissors.
If both players choose the same shape, the game is tied.

In our implementation, we use integer 3, 2, 1 to represent rock, scissors, paper respectively.
One player creates a game by submitting his/her choice in secret format.
The other player joins the game later and also submits his/her private choice to the application.
Once both players are present in the game, anyone could trigger the process to publicly reconstruct the result of the game.
The game is fair (two players decide what to play simultaneously) as no one would know the other player's choice. 

### Build docker image:

```shell
docker-compose build
```

(*NOTE*: If you previously built the image but it's outdated, you may want to pass
the build options`--no-cache` and/or `--pull`.)

### Start docker container:
```shell
docker-compose up -d
```

### Enter docker container:
```shell
docker exec -it honeybadgerswap_dev_1 bash
```

### Compile ratel program:
```shell
bash ratel/src/compile.sh [app_names] [finalize_on_chain(0 or 1)] [is_benchmark(0 or 1)]
```
```shell
bash ratel/src/compile.sh rockPaperScissors
```
Compile ratel programs (*.rl) in directory `ratel/src/rl` to python programs in `ratel/genfiles/python`, MP-SPDZ programs in `ratel/genfiles/mpc`, and Solidity contracts in `ratel/genfiles/contracts`.

### Start local private blockchain and deploy application contract:
```shell
bash ratel/src/deploy.sh [app_name] [token_num] [MPC_server_number] [threshold]
```
```shell
bash ratel/src/deploy.sh rockPaperScissors 0 4 1
```

You can also deploy ERC-20 token contracts by specifying a non-zero [token_num].

### Transfer Ether(token_id=0) to MPC servers and clients for them to pay transaction fee
```shell
python3 -m ratel.src.python.refill [user_name (see available choices in poa/keystore/)] [token_id]
```
```shell
python3 -m ratel.src.python.refill server_0 0 \
& python3 -m ratel.src.python.refill server_1 0 \
& python3 -m ratel.src.python.refill server_2 0 \
& python3 -m ratel.src.python.refill server_3 0
```
```shell
python3 -m ratel.src.python.refill client_1 0 \
& python3 -m ratel.src.python.refill client_2 0
```

### Start MPC servers to monitor events emitted by application contract and take MPC  tasks:
```shell
bash ratel/src/run.sh [app_name] [MPC_server_IDs] [MPC_server_number] [threshold] [concurrency] [test_flag]
```
```shell
bash ratel/src/run.sh rockPaperScissors 0,1,2,3 4 1 1 0
```
The script `ratel/src/run.sh` calls `ratel/src/python/[app_name]/run.py` to start servers respectively. 
`run.py` is not generated by ratel compiler.
Whenever creating a new application, you need to write `run.py` for the new app and put it under directory `ratel/src/python/[app_name]`.
A suggestion is to compare the difference of `ratel/src/python/rockPaperScissors/run.py` and `ratel/src/python/hbswap/run.py` and you will know how to write `run.py` for your new application.

### Interact with app contract
```shell
python3 -m ratel.src.python.rockPaperScissors.interact 
```
`ratel/src/python/rockPaperScissors/interact.py` shows how clients would interact with the rock-paper-scissors application.
In this Python program, we show all 9 possible scenarios of the RockPaperScissors game.
You can search for "!!!! winner" in the terminal to see the result of each game.
